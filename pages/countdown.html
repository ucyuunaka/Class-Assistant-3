<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>考试倒计时 - 课堂助手</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <!-- 不再引入侧边栏CSS，由组件自动加载 -->
    <!-- 页脚样式现在也由组件自动加载 -->
    <!-- 滚动动画样式现在也由组件自动加载 -->
    <!-- 添加主题样式 -->
    <link rel="stylesheet" href="/css/themes/themes.css" />
    <!-- 使用图标库 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- 添加 Remix Icon 库，用于侧边栏图标 -->
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <!-- 添加页面特定样式 -->
    <link rel="stylesheet" href="/css/pages/countdown.css" />

    <!-- 预先加载关键模块 -->
    <script type="module">
      // 立即导入并初始化模态框组件，确保其全局可用
      import {
        Modal,
        showConfirmModal,
        showWarningModal,
        showDangerModal,
      } from "/components/modals/modals.js";

      // 立即挂载到全局对象，确保在DOM加载前可用
      window.Modal = Modal;
      window.showConfirmModal = showConfirmModal;
      window.showWarningModal = showWarningModal;
      window.showDangerModal = showDangerModal;

      console.log("模态框组件已在页面加载早期预初始化");
    </script>
  </head>
  <body>
    <!-- 侧边栏导航 - 使用ID以便组件初始化 -->
    <div id="sidebar-container"></div>

    <!-- 移动端菜单切换按钮 -->

    <!-- 移动端遮罩层 -->
    <div class="sidebar-overlay"></div>

    <!-- 主内容区 -->
    <div class="container py-4 sidebar-active">
      <!-- 顶栏容器 - 添加ID用于组件初始化 -->
      <div id="header-container"></div>

      <!-- 筛选和排序 -->
      <div class="filters animate-on-scroll fade-up">
        <div class="search-box">
          <i class="fas fa-search search-icon"></i>
          <input
            type="text"
            class="form-control"
            placeholder="搜索考试..."
            id="search-input"
          />
        </div>
        <div class="filter-options">
          <div class="filter-group">
            <span class="filter-label">排序：</span>
            <select class="form-control" id="sort-select">
              <option value="date-asc">日期升序</option>
              <option value="date-desc" selected>日期降序</option>
              <option value="name-asc">名称升序</option>
              <option value="name-desc">名称降序</option>
            </select>
            <button
              type="button"
              class="btn-clear"
              id="clear-sort"
              aria-label="清除排序"
            >
              <i class="fas fa-times-circle"></i>
            </button>
          </div>
          <div class="filter-group">
            <span class="filter-label">状态：</span>
            <select class="form-control" id="filter-select">
              <option value="all" selected>全部</option>
              <option value="urgent">紧急 (7天内)</option>
              <option value="upcoming">即将到来 (30天内)</option>
              <option value="distant">较远 (30天以上)</option>
            </select>
            <button
              type="button"
              class="btn-clear"
              id="clear-filter"
              aria-label="清除筛选"
            >
              <i class="fas fa-times-circle"></i>
            </button>
          </div>
        </div>
        <!-- 添加筛选反馈区 -->
        <div class="filter-feedback" id="filter-feedback">
          正在显示符合条件的考试
        </div>
      </div>

      <!-- 考试倒计时列表 -->
      <div class="countdown-list" id="countdown-list">
        <!-- 动态生成考试列表，移除静态内容 -->
        <!-- 添加加载指示器 -->
        <div class="loading-indicator" id="loading-indicator">
          <i class="fas fa-circle-notch fa-spin"></i>
          <p>加载中...</p>
        </div>
      </div>

      <!-- 无考试时显示的空状态 -->
      <div
        class="empty-state animate-on-scroll fade-up"
        id="empty-state"
        style="display: none"
      >
        <div class="empty-icon">
          <i class="fas fa-calendar-xmark"></i>
        </div>
        <h3>暂无考试数据</h3>
        <p>点击"添加考试"按钮创建你的第一个考试倒计时</p>
        <button class="btn btn-primary" id="add-exam-empty">
          <i class="fas fa-plus"></i> 添加考试
        </button>
      </div>
    </div>

    <!-- 添加/编辑考试弹框 - 修复结构确保正确显示 -->
    <div class="modal" id="exam-modal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-close" id="close-exam-modal" aria-label="关闭">
            ×
          </div>
          <h2 class="modal-title" id="modal-title">添加考试</h2>
          <form id="exam-form">
            <div class="form-group">
              <label class="form-label" for="exam-name">考试名称</label>
              <input
                type="text"
                class="form-control"
                id="exam-name"
                required
                placeholder="例如：高等数学期末考试"
              />
            </div>
            <div class="form-group">
              <label class="form-label" for="exam-subject">科目</label>
              <input
                type="text"
                class="form-control"
                id="exam-subject"
                placeholder="例如：高等数学"
              />
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="exam-date">考试日期</label>
                <input
                  type="date"
                  class="form-control"
                  id="exam-date"
                  required
                />
              </div>
              <div class="form-group">
                <label class="form-label" for="exam-time">考试时间</label>
                <input
                  type="time"
                  class="form-control"
                  id="exam-time"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label class="form-label" for="exam-location">考试地点</label>
              <input
                type="text"
                class="form-control"
                id="exam-location"
                placeholder="例如：教学楼A-301"
              />
            </div>
            <div class="form-group">
              <label class="form-label" for="exam-notes">备注</label>
              <textarea
                class="form-control"
                id="exam-notes"
                rows="3"
                placeholder="例如：考试范围、注意事项等"
              ></textarea>
            </div>
            <input type="hidden" id="exam-id" value="" />
            <div class="form-actions">
              <button type="button" class="btn btn-outline" id="cancel-exam">
                取消
              </button>
              <button type="submit" class="btn btn-primary">保存</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- 撤销操作按钮 -->
    <button class="undo-btn" id="undo-btn" style="display: none">
      <i class="fas fa-undo-alt"></i> 撤销删除
    </button>

    <!-- 页脚 - 简化为只保留容器 -->
    <footer class="footer"></footer>
    <script type="module" src="/js/main.js"></script>
    <!-- 引入新的侧边栏组件 -->
    <script type="module" src="/components/sidebar/sidebar.js"></script>
    <!-- 引入顶栏组件 -->
    <script type="module" src="/components/header/header.js"></script>
    <!-- 初始化侧边栏组件 -->
    <script type="module">
      import { Sidebar } from "/components/sidebar/sidebar.js";
      import { Header } from "/components/header/header.js";

      document.addEventListener("DOMContentLoaded", function () {
        // 初始化侧边栏
        const sidebar = new Sidebar("sidebar-container");

        // 初始化顶栏组件
        const header = new Header("header-container", {
          isHomePage: false,
          title: "考试倒计时",
          subtitle: "管理你的考试安排，不错过任何重要的考试",
          buttons: [
            {
              text: "添加考试",
              url: "#",
              isPrimary: true,
              className: "add-exam-btn", // 保持与原来相同的类名，以便原有的事件处理能够正常工作
            },
          ],
          buttonPosition: "right",
        });

        // 发出模态框就绪事件通知
        const modalReadyEvent = new CustomEvent("modals:ready");
        document.dispatchEvent(modalReadyEvent);
        console.log("DOMContentLoaded: 发送模态框就绪事件通知");
      });
    </script>
    <!-- 添加页脚脚本 -->
    <script type="module" src="/components/footer/footer.js"></script>
    <!-- 添加滚动动画脚本 -->
    <script
      type="module"
      src="/components/scrollAnimation/scrollAnimation.js"
    ></script>
    <!-- 添加通知组件脚本 -->
    <script
      type="module"
      src="/components/notifications/notifications.js"
    ></script>
    <!-- 添加主题管理脚本 -->
    <script type="module" src="/js/themes.js"></script>
    <!-- 添加倒计时页面特定脚本 -->
    <script type="module" src="/js/pages/countdown/countdown.js"></script> <!-- Updated path -->
  </body>
</html>
